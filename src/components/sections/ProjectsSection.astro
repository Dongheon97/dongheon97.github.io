---
import Section from '../ui/Section.astro';
import SectionTitle from '../ui/SectionTitle.astro';
import Container from '../ui/Container.astro';
import Card from '../ui/Card.astro';
import Chip from '../ui/Chip.astro';
import siteContent from '../../content/site.json';

interface Project {
  slug: string;
  title: string;
  one_liner: string;
  tags: string[];
  thumbnail: string;
}

const projects = siteContent.projects;
const baseUrl = import.meta.env.BASE_URL;
---

<Section id="projects">
  <Container>
    <SectionTitle
      title="Projects"
      subtitle="Featured work and projects"
    />

    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
      {projects.map((project) => (
        <Card
          class="overflow-hidden cursor-pointer hover:scale-105 transition-transform duration-200"
          onclick={`window.openProjectModal('${project.slug}')`}
        >
          <div class="aspect-video bg-gray-100 overflow-hidden">
            <img
              src={`${baseUrl}${project.thumbnail.startsWith('/') ? project.thumbnail.slice(1) : project.thumbnail}`}
              alt={`${project.title} thumbnail`}
              class="w-full h-full object-cover"
              loading="lazy"
            />
          </div>
          <div class="p-6">
            <h3 class="text-2xl font-bold text-gray-900 mb-2">
              {project.title}
            </h3>
            <p class="text-lg text-gray-600 mb-4">
              {project.one_liner}
            </p>
            <div class="flex flex-wrap gap-2">
              {project.tags.map((tag) => (
                <Chip>
                  {tag}
                </Chip>
              ))}
            </div>
          </div>
        </Card>
      ))}
    </div>

    <div id="project-modal-overlay" class="modal-overlay hidden fixed inset-0 bg-black/50 z-50"></div>
    <div id="project-modal" class="modal hidden fixed inset-0 z-50 flex items-center justify-center p-4">
      <div class="modal-content bg-white rounded-lg max-w-6xl w-full max-h-[90vh] overflow-y-auto shadow-2xl" onclick="event.stopPropagation()">
        <div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center">
          <h2 id="modal-title" class="modal-title text-2xl font-bold text-gray-900"></h2>
          <button onclick="window.closeModal()" class="text-gray-400 hover:text-gray-600 transition-colors p-2">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
        <div id="modal-body" class="p-6"></div>
      </div>
    </div>

    <script define:vars={{ projectsData: projects }}>
      window.openProjectModal = function(slug) {
        const project = projectsData.find((p) => p.slug === slug);
        if (!project) return;

        const overlay = document.getElementById('project-modal-overlay');
        const modal = document.getElementById('project-modal');
        const title = document.getElementById('modal-title');
        const body = document.getElementById('modal-body');
        
        overlay.classList.remove('hidden');
        modal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
        
        if (title) title.textContent = project.title;
        
        if (body) {
          let html = '<p class="text-xl text-gray-700 mb-6 leading-relaxed">' + project.one_liner + '</p>';
          html += '<div class="flex flex-wrap gap-2 mb-8">';
          project.tags.forEach((tag) => {
            html += '<span class="px-4 py-1.5 bg-blue-100 text-blue-800 rounded-full text-base font-medium">' + tag + '</span>';
          });
          html += '</div>';
          
          if (project.timeframe) {
            html += '<p class="text-lg text-gray-600 mb-2"><strong>Timeframe:</strong> ' + project.timeframe + '</p>';
          }
          if (project.role) {
            html += '<p class="text-lg text-gray-600 mb-2"><strong>Role:</strong> ' + project.role + '</p>';
          }
          if (project.team) {
            html += '<p class="text-lg text-gray-600 mb-6"><strong>Team:</strong> ' + project.team + '</p>';
          }
          html += '</div></div>';
          
          // Nist 5.0 Challenge specific links
          html += "<div class='flex flex-wrap gap-4 mb-8'>";
          if (project.links.project) {
            html += '<a href="' + project.links.project + '" target="_blank" rel="noopener noreferrer" class="px-6 py-3 bg-gray-100 text-gray-900 rounded-lg hover:bg-gray-200 transition-colors font-medium text-lg">üó∫Ô∏è NIST 5.0 Challenge</a>';
          }
          if (project.links.team) {
            html += '<a href="' + project.links.team + '" target="_blank" rel="noopener noreferrer" class="px-6 py-3 bg-gray-100 text-gray-900 rounded-lg hover:bg-gray-200 transition-colors font-medium text-lg">üë• EpiSci Description</a>';
          }
          html += "</div>";

          html += '<div class="grid md:grid-cols-2 gap-8 mb-8">';
          html += '<div>';
          html += '<h3 class="text-2xl font-bold text-gray-900 mb-4">üéØ Problem</h3>';
          html += '<ul class="space-y-3 text-lg text-gray-700 leading-relaxed">';
          project.problem.forEach((item) => {
            html += '<li class="flex items-start"><span class="mr-3 mt-1.5 w-1.5 h-1.5 bg-red-500 rounded-full flex-shrink-0"></span><span>' + item + '</span></li>';
          });
          html += '</ul></div>';
          html += '<div>';
          html += '<h3 class="text-2xl font-bold text-gray-900 mb-4">üí° Approach</h3>';
          html += '<ul class="space-y-3 text-lg text-gray-700 leading-relaxed">';
          project.approach.forEach((item) => {
            html += '<li class="flex items-start"><span class="mr-3 mt-1.5 w-1.5 h-1.5 bg-green-500 rounded-full flex-shrink-0"></span><span>' + item + '</span></li>';
          });
          html += '</ul></div>';
          html += '</div>';

          html += '<div class="mb-8">';
          html += '<h3 class="text-2xl font-bold text-gray-900 mb-4">üöÄ My Contribution</h3>';
          html += '<ul class="space-y-3 text-lg text-gray-700 leading-relaxed">';
          project.contributions.forEach((item) => {
            html += '<li class="flex items-start"><span class="mr-3 mt-1.5 w-1.5 h-1.5 bg-blue-500 rounded-full flex-shrink-0"></span><span>' + item + '</span></li>';
          });
          html += '</ul>';
          html += '</div>';

          html += '<div class="mb-8">';
          html += '<h3 class="text-2xl font-bold text-gray-900 mb-4">üìä Results</h3>';
          html += '<ul class="space-y-3 text-lg text-gray-700 leading-relaxed">';
          project.results.forEach((item) => {
            html += '<li class="flex items-start"><span class="mr-3 mt-1.5 w-1.5 h-1.5 bg-purple-500 rounded-full flex-shrink-0"></span><span>' + item + '</span></li>';
          });
          html += '</ul>';
          html += '</div>';

          html += '<div class="mb-8">';
          html += '<h3 class="text-2xl font-bold text-gray-900 mb-4">üé¨ Demo Video</h3>';
          html += '<div class="aspect-video bg-gray-100 rounded-xl overflow-hidden shadow-lg">';
          html += '<iframe src="' + project.media.embed_url + '" class="w-full h-full" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen title="' + project.title + ' demo"></iframe>';
          html += '</div>';
          html += '<ul class="space-y-3 text-lg text-gray-700 leading-relaxed">';
          html += '<li class="flex items-start"><span class="mr-3 mt-1.5 w-1.5 h-1.5 bg-gray-900 rounded-full flex-shrink-0"></span><span>' + project.media.description + '</span></li>';
          html += '</ul>';
          html += '</div>';

          if (project.sub_media) {
            html += '<div class="mb-8">';
            html += '<div class="aspect-video bg-gray-100 rounded-xl overflow-hidden shadow-lg">';
            html += '<iframe src="' + project.sub_media.embed_url + '" class="w-full h-full" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen title="' + project.title + ' sub demo"></iframe>';
            html += '</div>';
            html += '<ul class="space-y-3 text-lg text-gray-700 leading-relaxed">';
            html += '<li class="flex items-start"><span class="mr-3 mt-1.5 w-1.5 h-1.5 bg-gray-900 rounded-full flex-shrink-0"></span><span>' + project.sub_media.description + '</span></li>';
            html += '</ul>';
            html += '</div>';
          }

          if (project.links) {
            html += '<div>';
            html += '<h3 class="text-2xl font-bold text-gray-900 mb-4">üîó Links</h3>';
            html += '<div class="flex flex-wrap gap-4">';
            if (project.links.github) {
              html += '<a href="' + project.links.github + '" target="_blank" rel="noopener noreferrer" class="px-6 py-3 bg-gray-100 text-gray-900 rounded-lg hover:bg-gray-200 transition-colors font-medium text-lg flex items-center gap-2"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84-1.235 1.911-1.236 3.221 1.236 4.607 2.807 5.931 5.467 0 4.597-3.802 5.931-5.467 5.931-4.637 0-8.4-3.793-8.4-8.4 0-6.627 5.373-12 12-12z"/></svg> GitHub</a>';
            }
            if (project.links.paper) {
              html += '<a href="' + project.links.paper + '" target="_blank" rel="noopener noreferrer" class="px-6 py-3 bg-gray-100 text-gray-900 rounded-lg hover:bg-gray-200 transition-colors font-medium text-lg">üìÑ Paper</a>';
            }
            if (project.links.slides) {
              html += '<a href="' + project.links.slides + '" target="_blank" rel="noopener noreferrer" class="px-6 py-3 bg-gray-100 text-gray-900 rounded-lg hover:bg-gray-200 transition-colors font-medium text-lg">üìä Slides</a>';
            }
            // if (project.links.project) {
            //   html += '<a href="' + project.links.project + '" target="_blank" rel="noopener noreferrer" class="px-6 py-3 bg-gray-100 text-gray-900 rounded-lg hover:bg-gray-200 transition-colors font-medium text-lg">üöÄ Project Page</a>';
            // }
            // if (project.links.team) {
            //   html += '<a href="' + project.links.team + '" target="_blank" rel="noopener noreferrer" class="px-6 py-3 bg-gray-100 text-gray-900 rounded-lg hover:bg-gray-200 transition-colors font-medium text-lg">üë• Team</a>';
            // }
            // html += '</div></div>';
          }

          body.innerHTML = html;
        }
      };

      window.closeModal = function() {
        const overlay = document.getElementById('project-modal-overlay');
        const modal = document.getElementById('project-modal');
        const title = document.getElementById('modal-title');
        const body = document.getElementById('modal-body');

        if (overlay) overlay.classList.add('hidden');
        if (modal) modal.classList.add('hidden');
        document.body.style.overflow = '';

        if (title) title.textContent = '';
        if (body) body.innerHTML = '';
      };

      document.addEventListener('click', function(e) {
        const overlay = document.querySelector('.modal-overlay');
        if (e.target === overlay) {
          window.closeModal();
        }
      });

      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          window.closeModal();
        }
      });
    </script>
  </Container>
</Section>
